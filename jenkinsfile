pipeline {
  agent any

  environment {
    APP_NAME = "NeonApp"
    MODE = "DEV"
  }

  stages {

    // STAGE 1: Create file + insert text
    stage("Create File & Write Text") {
      steps {
        sh '''
          echo "File created by Jenkins" > glow.txt
          echo "App Name: $APP_NAME" >> glow.txt
          cat glow.txt
        '''
      }
    }

    // STAGE 2: Create script + run it + condition inside steps
    stage("Create Script & Run with Condition") {
      steps {
        sh '''
          echo '#!/bin/bash' > run.sh
          echo 'echo "Script is running..."' >> run.sh
          echo 'echo "Current Mode: $MODE"' >> run.sh
          chmod +x run.sh
        '''

        script {
          if (env.MODE == "DEV") {
            sh "./run.sh"
          } else {
            echo "Script blocked due to MODE"
          }
        }
      }
    }

    //STAGE 3: Use environment value + create something else
    stage("Env Value + Final Output") {
      steps {
        sh '''
          echo "Final Stage for $APP_NAME" > final.txt
          echo "Pipeline executed in $MODE mode" >> final.txt
          cat final.txt
        '''
      }
    }

  }
}
